/* (08) Legal actions touched recently
   Maps to Portal: dbo.tblStg_LegalCasesActions
*/

DECLARE @LookbackMonths int = 3;
DECLARE @CutoffDate date = CAST(DATEADD(MONTH, -@LookbackMonths, GETDATE()) AS date);

SELECT
    la.hMy            AS legalActionRowID,
    la.hLegal         AS yardiLegalRowID,
    la.dtBegin,
    la.dtDue,
    t.sDisplay        AS ActionTypeDesc,
    e.sDisplay        AS EventDesc,
    la.sCheck,
    la.fAmount,
    la.sNote,
    la.dAttourneyFee,
    la.dtCreated,
    la.dtLastModified
FROM legalaction la
LEFT JOIN LegalLookup t ON t.hMy = la.hType
LEFT JOIN LegalLookup e ON e.hMy = la.hEvent
WHERE
      (la.dtLastModified IS NOT NULL AND CAST(la.dtLastModified AS date) >= @CutoffDate)
   OR (la.dtCreated      IS NOT NULL AND CAST(la.dtCreated      AS date) >= @CutoffDate)
   OR (la.dtBegin        IS NOT NULL AND CAST(la.dtBegin        AS date) >= @CutoffDate)
   OR (la.dtDue          IS NOT NULL AND CAST(la.dtDue          AS date) >= @CutoffDate)
ORDER BY la.hMy;